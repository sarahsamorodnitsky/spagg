<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Considering Multiple Radii in a spagg Analysis • spagg</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Considering Multiple Radii in a spagg Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spagg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/spagg.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/lung_analysis.html">Applying spagg to a Non-Small Cell Lung Cancer Data</a></li>
    <li><a class="dropdown-item" href="../articles/SPOT.html">Considering Multiple Radii in a spagg Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Considering Multiple Radii in a spagg Analysis</h1>
            
      

      <div class="d-none name"><code>SPOT.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sarahsamorodnitsky.github.io/spagg/">spagg</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SPOT</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>To apply spatial summary statistics, like Ripley’s K, in analyses of
multiplexed spatial proteomics imaging data, the user is required to
select a radius in which to quantify the degree of clustering,
repulsion, or lack thereof. The optimal radius, however, is typically
unknown beforehand. To this end, it can be helpful to consider a range
of candidate radii at which to calculate Ripley’s K and test for an
association at each radius, aggregating the resulting p-values. This is
the idea behind the SPatial Omnibus Test (SPOT) <span class="citation">@samorodnitsky2024spatial</span>. In this vignette, we
discuss integrating <code>spagg</code> with SPOT using the associated R
package, <code>SPOT</code>. This will allow us to compute Ripley’s K at
several candidate radii, aggregate the resulting spatial summary
statistics for a given radius within a sample across regions-of-interest
(ROIs), test for an association between the aggregated spatial summary
and an outcome, and combine the results across radii.</p>
<p>For this analysis, we will use the non-small cell lung cancer dataset
used in another <code>spagg</code> vignette. As described there, we will
downloaded the data from <a href="http://juliawrobel.com/MI_tutorial/MI_Data.html" class="external-link uri">http://juliawrobel.com/MI_tutorial/MI_Data.html</a> but is
also available from the <code>VectraPolarisData</code> R package. For
the purposes of this illustration, we do some basic tidying of the data
prior to analysis. The steps to this are similar to those given in the
link given above. These steps are shown below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load in the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"http://juliawrobel.com/MI_tutorial/Data/lung.RDA"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Label the immune cell types</span></span>
<span><span class="va">lung_df</span> <span class="op">&lt;-</span> <span class="va">lung_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">phenotype_cd14</span> <span class="op">==</span> <span class="st">"CD14+"</span> <span class="op">~</span> <span class="st">"CD14+ cell"</span>,</span>
<span>    <span class="va">phenotype_cd19</span> <span class="op">==</span> <span class="st">"CD19+"</span> <span class="op">~</span> <span class="st">"CD19+ B cell"</span>,</span>
<span>    <span class="va">phenotype_cd4</span> <span class="op">==</span> <span class="st">"CD4+"</span> <span class="op">~</span> <span class="st">"CD4+ T cell"</span>,</span>
<span>    <span class="va">phenotype_cd8</span> <span class="op">==</span> <span class="st">"CD8+"</span> <span class="op">~</span> <span class="st">"CD8+ T cell"</span>,</span>
<span>    <span class="va">phenotype_other</span> <span class="op">==</span> <span class="st">"Other+"</span> <span class="op">~</span> <span class="st">"Other"</span>,</span>
<span>    <span class="va">phenotype_ck</span> <span class="op">==</span> <span class="st">"CK+"</span> <span class="op">~</span> <span class="st">"Tumor"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a column indicating if a sample has &gt;=5% MHCII+ tumor cells</span></span>
<span><span class="va">lung_df</span> <span class="op">&lt;-</span> <span class="va">lung_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                       </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">patient_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mhcII_high <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mhcII_status</span> <span class="op">==</span> <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change colnames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">lung_df</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">lung_df</span><span class="op">)</span> <span class="op">==</span> <span class="st">"patient_id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"PID"</span></span>
<span></span>
<span><span class="co"># Add a PID column</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">lung_df</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">lung_df</span><span class="op">)</span> <span class="op">==</span> <span class="st">"image_id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"id"</span></span>
<span></span>
<span><span class="co"># Filter to just cells detected within the tumor</span></span>
<span><span class="va">lung_df_tumor</span> <span class="op">&lt;-</span> <span class="va">lung_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tissue_category</span> <span class="op">==</span> <span class="st">"Tumor"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove grouping</span></span>
<span><span class="va">lung_df_tumor</span> <span class="op">&lt;-</span> <span class="va">lung_df_tumor</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove NA types</span></span>
<span><span class="va">lung_df_tumor</span> <span class="op">&lt;-</span> <span class="va">lung_df_tumor</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the first few rows of the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lung_df_tumor</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 39</span></span></span>
<span><span class="co">#&gt;   id              PID   cell_id     x     y gender mhcII_status age_at_diagnosis</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> #01 0-889-121 … #01 …       5  453    2.5 F      low                        85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> #01 0-889-121 … #01 …       6  463    2.5 F      low                        85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> #01 0-889-121 … #01 …      11  464    8.5 F      low                        85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> #01 0-889-121 … #01 …      12  538   10   F      low                        85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> #01 0-889-121 … #01 …      21  522   20.5 F      low                        85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> #01 0-889-121 … #01 …      22  566.  25   F      low                        85</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 31 more variables: stage_at_diagnosis &lt;chr&gt;, stage_numeric &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   pack_years &lt;dbl&gt;, survival_days &lt;dbl&gt;, survival_status &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   cause_of_death &lt;chr&gt;, adjuvant_therapy &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   time_to_recurrence_days &lt;dbl&gt;, recurrence_or_lung_ca_death &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   tissue_category &lt;chr&gt;, cd19 &lt;dbl&gt;, cd3 &lt;dbl&gt;, cd14 &lt;dbl&gt;, cd8 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   hladr &lt;dbl&gt;, ck &lt;dbl&gt;, dapi &lt;dbl&gt;, entire_cell_axis_ratio &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   entire_cell_major_axis &lt;dbl&gt;, entire_cell_minor_axis &lt;dbl&gt;, …</span></span></span></code></pre></div>
<p>There are four immune cell types available in this dataset: CD14+
cell, CD4+ T cell, CD8+ T cell, and CD19+ B cell. We will examine the
pairwise colocalization of CD4+ T cells and tumor cells as well as CD8+
T cells and tumor cells and their associations with a sample exhibiting
an MHCII-high tumor microenvironment (TME).</p>
<p>As described in the introductory vignette, <code>spagg</code>
contains six approaches for aggregating spatial summaries at a given
radius. Three of these approaches are weighted means and the other three
are ensemble approaches. Currently, the <code>SPOT</code> package does
not accommodate incorporating ensemble testing into the framework. This
feature is in development. For now, we will focus on applying the first
three weighted means to test for an association with MHCII-high TME.</p>
<p>The first three approaches are weighted means of the summary
statistics are given below:</p>
<ol style="list-style-type: decimal">
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mover><mi>K</mi><mo accent="true">‾</mo></mover><mi>i</mi><mrow><mi>D</mi><mi>i</mi><mi>g</mi><mi>g</mi><mi>l</mi><mi>e</mi></mrow></msubsup><mo>=</mo><mfrac><mn>1</mn><mrow><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msub><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msub><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub><msub><mover><mi>K</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\begin{equation*}
\bar K_i^{Diggle} = \frac{1}{\sum_{r=1}^{R_i} n_{ir}} \sum_{r=1}^{R_i} n_{ir} \hat K_{ir}
\end{equation*}</annotation></semantics></math></p></li>
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mover><mi>K</mi><mo accent="true">‾</mo></mover><mi>i</mi><mrow><mi>B</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>e</mi><mi>l</mi><mi>e</mi><mi>y</mi></mrow></msubsup><mo>=</mo><mfrac><mn>1</mn><mrow><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msubsup><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow><mn>2</mn></msubsup></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msubsup><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow><mn>2</mn></msubsup><msub><mover><mi>K</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\begin{equation*}
  \bar K_i^{Baddeley} = \frac{1}{\sum_{r=1}^{R_i} n^2_{ir}} \sum_{r=1}^{R_i} n^2_{ir} \hat K_{ir} \end{equation*}</annotation></semantics></math></p></li>
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mover><mi>K</mi><mo accent="true">‾</mo></mover><mi>i</mi><mrow><mi>L</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>a</mi><mi>u</mi></mrow></msubsup><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msub><mi>A</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow><mrow><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msub><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><mfrac><msubsup><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow><mn>2</mn></msubsup><msub><mi>A</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub></mfrac><msub><mover><mi>K</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\begin{equation*}
  \bar K_i^{Landau} = \frac{\sum_{r=1}^{R_i} A_{ir}}{\sum_{r=1}^{R_i} n_{ir}} \sum_{r=1}^{R_i} \frac{n^2_{ir}}{A_{ir}} \hat K_{ir} 
\end{equation*}</annotation></semantics></math></p></li>
</ol>
<p>The steps to our analysis are as follows:</p>
<ol style="list-style-type: decimal">
<li><p>We will determine a range of candidate radii in advance. For this
analysis, we will use Ripley’s rule of thumb and consider radii between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.25</mn><annotation encoding="application/x-tex">0.25</annotation></semantics></math>
times the shortest length of any image in the dataset.</p></li>
<li><p>We will compute Ripley’s K for each radius
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mn>0</mn><mo>,</mo><mn>10</mn><mo>,</mo><mn>20</mn><mo>,</mo><mn>30</mn></mrow><annotation encoding="application/x-tex">r = 0, 10, 20, 30</annotation></semantics></math>
and for each ROI. Within each sample, we will aggregate the spatial
summaries across ROIs using an arithmetic mean, the Diggle mean, the
Landau mean, and the Baddeley mean. We will then test for an association
between the aggregated spatial summaries and MHCII-high status. At the
end, we will aggregate the p-values using the Cauchy combination test
(CCT) <span class="citation">@liu2020cauchy</span>.</p></li>
<li><p>We will also use the ensemble approaches to aggregate the spatial
summaries and test for an association with the outcome. This will
involve two nested p-value combination steps: (1) at the ensemble
testing level, we will aggregate the p-values using the CCT across
ensemble replications; (2) at the SPOT level, we will aggregate the
ensemble p-values across radii using the CCT again.</p></li>
<li><p>At the end, we will assess which cell type pairs have significant
associations with MHCII-high status.</p></li>
</ol>
<p>We first start by computing the range of radii to consider.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the radii </span></span>
<span><span class="va">smallest.dim</span> <span class="op">&lt;-</span> <span class="va">lung_df_tumor</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>x.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                   y.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x.range</span>, <span class="va">y.range</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the radii by Ripley's rule</span></span>
<span><span class="va">radii</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">smallest.dim</span><span class="op">$</span><span class="va">min</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>Next, we iterate through the two pairs of cell types, calculating
Ripley’s K for each radius value, and computing each of our weighted
averages (and a standard arithmetic mean) for each sample. At the end,
we will test for an association between each average and MHCII-status.
All of this can be done using the <code>SPOT</code> package which allows
the user to select an aggregation method to average spatial summary
statistics across ROIs.</p>
<p>We first consider the colocalization of CD4+ T cells and tumor cells
for each aggregation method. We also adjust for patient age in our
analysis.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using an arithmetic mean</span></span>
<span><span class="va">cd4.tumor.mean.res</span> <span class="op">&lt;-</span> <span class="fu">SPOT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SPOT/man/spot.html" class="external-link">spot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lung_df_tumor</span>, </span>
<span>                                 radii <span class="op">=</span> <span class="va">radii</span>,</span>
<span>                                 outcome <span class="op">=</span> <span class="st">"mhcII_high"</span>, </span>
<span>                                 censor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                 model.type <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                                 use.K <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 homogeneous <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 adjustments <span class="op">=</span> <span class="st">"age_at_diagnosis"</span>,</span>
<span>                                 marked <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 cell.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4+ T cell"</span>, <span class="st">"Tumor"</span><span class="op">)</span>,</span>
<span>                                 pick.roi <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Progress:   0%  Progress:   0%  Progress:   0%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress: 100%  Progress: 100%  Progress: 100%  Progress: 100%</span></span>
<span></span>
<span><span class="co"># Using the Diggle mean</span></span>
<span><span class="va">cd4.tumor.diggle.res</span> <span class="op">&lt;-</span> <span class="fu">SPOT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SPOT/man/spot.html" class="external-link">spot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lung_df_tumor</span>, </span>
<span>                                 radii <span class="op">=</span> <span class="va">radii</span>,</span>
<span>                                 outcome <span class="op">=</span> <span class="st">"mhcII_high"</span>, </span>
<span>                                 censor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                 model.type <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                                 use.K <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 homogeneous <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 adjustments <span class="op">=</span> <span class="st">"age_at_diagnosis"</span>,</span>
<span>                                 marked <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 cell.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4+ T cell"</span>, <span class="st">"Tumor"</span><span class="op">)</span>,</span>
<span>                                 pick.roi <span class="op">=</span> <span class="st">"diggle"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Progress:   0%  Progress:   0%  Progress:   0%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress: 100%  Progress: 100%  Progress: 100%  Progress: 100%</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span></span>
<span><span class="co"># Using the Baddeley mean</span></span>
<span><span class="va">cd4.tumor.baddeley.res</span> <span class="op">&lt;-</span> <span class="fu">SPOT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SPOT/man/spot.html" class="external-link">spot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lung_df_tumor</span>, </span>
<span>                                 radii <span class="op">=</span> <span class="va">radii</span>,</span>
<span>                                 outcome <span class="op">=</span> <span class="st">"mhcII_high"</span>, </span>
<span>                                 censor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                 model.type <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                                 use.K <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 homogeneous <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 adjustments <span class="op">=</span> <span class="st">"age_at_diagnosis"</span>,</span>
<span>                                 marked <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 cell.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4+ T cell"</span>, <span class="st">"Tumor"</span><span class="op">)</span>,</span>
<span>                                 pick.roi <span class="op">=</span> <span class="st">"baddeley"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Progress:   0%  Progress:   0%  Progress:   0%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress: 100%  Progress: 100%  Progress: 100%  Progress: 100%</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span></span>
<span><span class="co"># Using the Landau mean</span></span>
<span><span class="va">cd4.tumor.landau.res</span> <span class="op">&lt;-</span> <span class="fu">SPOT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SPOT/man/spot.html" class="external-link">spot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lung_df_tumor</span>, </span>
<span>                                 radii <span class="op">=</span> <span class="va">radii</span>,</span>
<span>                                 outcome <span class="op">=</span> <span class="st">"mhcII_high"</span>, </span>
<span>                                 censor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                 model.type <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                                 use.K <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 homogeneous <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 adjustments <span class="op">=</span> <span class="st">"age_at_diagnosis"</span>,</span>
<span>                                 marked <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 cell.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4+ T cell"</span>, <span class="st">"Tumor"</span><span class="op">)</span>,</span>
<span>                                 pick.roi <span class="op">=</span> <span class="st">"landau"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Progress:   0%  Progress:   0%  Progress:   0%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   1%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   2%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   3%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   4%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   5%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   6%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   7%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   8%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:   9%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  10%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  11%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  12%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  13%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  14%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  15%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  16%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  17%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  18%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  19%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  20%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  21%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  22%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  23%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  24%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  25%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  26%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  27%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  28%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  29%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  30%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  31%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  32%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  33%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  34%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  35%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  36%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  37%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  38%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  39%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  40%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  41%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  42%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  43%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  44%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  45%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  46%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  47%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  48%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  49%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  50%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  51%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  52%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  53%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  54%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  55%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  56%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  57%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  58%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  59%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  60%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  61%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  62%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  63%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  64%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  65%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  66%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  67%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  68%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  69%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  70%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  71%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  72%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  73%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  74%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  75%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  76%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  77%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  78%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  79%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  80%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  81%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  82%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  83%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  84%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  85%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  86%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  87%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  88%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  89%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  90%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  91%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  92%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  93%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  94%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  95%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  96%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  97%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  98%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress:  99%  Progress: 100%  Progress: 100%  Progress: 100%  Progress: 100%</span></span>
<span></span>
<span><span class="co"># Create a data.frame to show the p-values</span></span>
<span><span class="va">cd4.tumor.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mean"</span>, <span class="st">"Diggle"</span>, <span class="st">"Baddeley"</span>, <span class="st">"Landau"</span><span class="op">)</span>,</span>
<span>  P.Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cd4.tumor.mean.res</span><span class="op">$</span><span class="va">overall.pval</span>, <span class="va">cd4.tumor.diggle.res</span><span class="op">$</span><span class="va">overall.pval</span>,</span>
<span>              <span class="va">cd4.tumor.baddeley.res</span><span class="op">$</span><span class="va">overall.pval</span>, <span class="va">cd4.tumor.landau.res</span><span class="op">$</span><span class="va">overall.pval</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display</span></span>
<span><span class="va">cd4.tumor.df</span></span>
<span><span class="co">#&gt;     Method    P.Value</span></span>
<span><span class="co">#&gt; 1     Mean 0.08080625</span></span>
<span><span class="co">#&gt; 2   Diggle 0.04128158</span></span>
<span><span class="co">#&gt; 3 Baddeley 0.03202144</span></span>
<span><span class="co">#&gt; 4   Landau 0.09480697</span></span></code></pre></div>
<p>We can also examine how the p-values associated with each aggregated
method varied across radii. Below, we plot the log10-transformed p-value
as a function of the radius to examine how significance varies.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, combine the results together across methods</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">cd4.tumor.mean.res</span><span class="op">$</span><span class="va">pval.df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">radius</span>, <span class="va">pval</span><span class="op">)</span>,</span>
<span>  <span class="va">cd4.tumor.diggle.res</span><span class="op">$</span><span class="va">pval.df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">radius</span>, <span class="va">pval</span><span class="op">)</span>,</span>
<span>  <span class="va">cd4.tumor.baddeley.res</span><span class="op">$</span><span class="va">pval.df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">radius</span>, <span class="va">pval</span><span class="op">)</span>,</span>
<span>  <span class="va">cd4.tumor.landau.res</span><span class="op">$</span><span class="va">pval.df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">radius</span>, <span class="va">pval</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"source"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename the "source" column, which indicates the mean type</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Mean"</span></span>
<span></span>
<span><span class="co"># Rename the values of the Mean column</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">Mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Mean</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mean"</span>, <span class="st">"Diggle"</span>, <span class="st">"Baddeley"</span>, <span class="st">"Landau"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the log10-transformed p-values</span></span>
<span><span class="va">results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>log10.pval <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">pval</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">radius</span>, y <span class="op">=</span> <span class="va">log10.pval</span>, color <span class="op">=</span> <span class="va">Mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Radius"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"-log10(P-Value)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"P-Values for Association Between Tumor and CD4+ T Cell \n Colocalization and MHCII-High Status Across Radii"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SPOT_files/figure-html/plotting%20p-value%20vs.%20radii-1.png" width="672" style="display: block; margin: auto;">
The above plot illustrates how the significance of the association
between tumor-CD4+ T cell colocalization and MHCII-high status varies as
a function of aggregation method (arithmetic mean, Diggle mean, Baddeley
mean, or Landau mean) and as a function of radius. The dashed line
indicates significance at an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha=0.05</annotation></semantics></math>
level. Log10-transformed p-values greater than this line are
significant. Between a radius of approximately
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>7</mn><annotation encoding="application/x-tex">7</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>12</mn><annotation encoding="application/x-tex">12</annotation></semantics></math>,
all four means show significance. After approximately a radius of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>40</mn><annotation encoding="application/x-tex">40</annotation></semantics></math>,
only the Baddeley mean shows consistent significance. This aligns with
the omnibus p-value for the Baddeley mean being the lowest among the
four options shown above.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sarah Samorodnitsky.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
