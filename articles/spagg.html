<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>spagg • spagg</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="spagg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spagg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/spagg.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/lung_analysis.html">Analysis of a Non-Small Cell Lung Cancer Dataset</a></li>
    <li><a class="dropdown-item" href="../articles/SPOT.html">Accommodating Multiple Radii</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>spagg</h1>
            
      

      <div class="d-none name"><code>spagg.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>In this vignette, we illustrate how to use the <code>spagg</code>
package to analyze multiple spatial point patterns. In particular, we
will show how to use the functions in this package to construct an
aggregate spatial summary statistic across point patterns grouped
together by some higher level factor, such as by tissue sample. We will
then use this aggregated spatial summary statistic as a predictor in a
linear model for a group-level/sample-level outcome.</p>
<p>The motivation behind <code>spagg</code> is that analyses of data
from multiplexed immunofluorescence and spatial proteomics platforms may
involve multiple regions-of-interest (ROIs) imaged from the same tissue
sample. Each ROI shows the spatial location of cells in tissue which can
be treated as a spatial point pattern. Access to multiple ROIs per
tissue sample can complicate associative analyses seeking to
characterize associations between the spatial distribution of cells in
tissue and sample-level outcomes because we need to test for an
association between a single sample-level outcome (e.g. survival or
case/control status) and multiple spatial summary statistics.</p>
<p>This vignette will use simulated spatial point pattern data. To see
how this data was generated, please see
<code>spagg &gt; data-raw &gt; simdata.R</code>.</p>
</div>
<div class="section level3">
<h3 id="loading-in-the-data-and-plotting">Loading in the Data and Plotting<a class="anchor" aria-label="anchor" href="#loading-in-the-data-and-plotting"></a>
</h3>
<p>We start by loading in the <code>spagg</code> package and our
simulated data. We show the first few lines of the dataset below. The
dataset is organized so as to mimic the structure of single-cell,
spatial images produced by multiplexed immunofluorescence and spatial
proteomics platforms. Each row corresponds to a detected cell, which is
enumerated by the <code>cell.id</code> column. The cells are grouped
together by samples, denoted by the <code>PID</code> column and by
images within those samples, denoted by the <code>id</code> column. The
<code>x</code> and <code>y</code> columns give the (x,y) coordinates of
each cell. The <code>type</code> column denotes the cell type for the
corresponding row. In this simulated dataset, the possible cell types
are <code>a</code> and <code>b</code>. Finally, the <code>out</code>
column gives the sample-level endpoint with which we are interested in
performing associative analyses. In this simulated dataset, the
<code>out</code> column is a binary <code>1</code> or <code>0</code>
indicator.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load in packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sarahsamorodnitsky.github.io/spagg/">spagg</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/" class="external-link">spatstat</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: spatstat.data</span></span>
<span><span class="co">#&gt; Loading required package: spatstat.univar</span></span>
<span><span class="co">#&gt; spatstat.univar 3.0-0</span></span>
<span><span class="co">#&gt; Loading required package: spatstat.geom</span></span>
<span><span class="co">#&gt; spatstat.geom 3.3-2</span></span>
<span><span class="co">#&gt; Loading required package: spatstat.random</span></span>
<span><span class="co">#&gt; spatstat.random 3.3-1</span></span>
<span><span class="co">#&gt; Loading required package: spatstat.explore</span></span>
<span><span class="co">#&gt; Loading required package: nlme</span></span>
<span><span class="co">#&gt; spatstat.explore 3.3-1</span></span>
<span><span class="co">#&gt; Loading required package: spatstat.model</span></span>
<span><span class="co">#&gt; Loading required package: rpart</span></span>
<span><span class="co">#&gt; spatstat.model 3.3-1</span></span>
<span><span class="co">#&gt; Loading required package: spatstat.linnet</span></span>
<span><span class="co">#&gt; spatstat.linnet 3.2-1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spatstat 3.1-1 </span></span>
<span><span class="co">#&gt; For an introduction to spatstat, type 'beginner'</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:nlme':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     collapse</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="co"># Load in data and show first few lines</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">)</span></span>
<span><span class="co">#&gt;   PID            id        x        y cell.id type out</span></span>
<span><span class="co">#&gt; 1   1 PID.1.image.1 27.09050 63.03496       1    a   1</span></span>
<span><span class="co">#&gt; 2   1 PID.1.image.1 21.97141 63.93355       2    a   1</span></span>
<span><span class="co">#&gt; 3   1 PID.1.image.1 18.70571 63.51489       3    b   1</span></span>
<span><span class="co">#&gt; 4   1 PID.1.image.1 20.29608 68.71936       4    b   1</span></span>
<span><span class="co">#&gt; 5   1 PID.1.image.1 22.74318 69.08458       5    b   1</span></span>
<span><span class="co">#&gt; 6   1 PID.1.image.1 17.47202 75.63201       6    b   1</span></span></code></pre></div>
<p>We can plot the images for <code>PID=1</code>. This can be a helpful
tool to visually assess variation in the spatial distribution of cells
across ROIs.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the images for PID=1 --</span></span>
<span></span>
<span><span class="co"># Save the image IDs</span></span>
<span><span class="va">PID.1.image.ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="va">simdata</span><span class="op">$</span><span class="va">PID</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a list of plots</span></span>
<span><span class="va">plot.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">PID.1.image.ids</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Iterate through the image IDs and create a plot for each</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">id.i</span> <span class="kw">in</span> <span class="va">PID.1.image.ids</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">pp</span> <span class="op">&lt;-</span> <span class="va">simdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">id.i</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">id.i</span><span class="op">)</span></span>
<span>  <span class="va">plot.list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">PID.1.image.ids</span> <span class="op">==</span> <span class="va">id.i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pp</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Construct the full plot</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plot.list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">plot.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                   <span class="va">plot.list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">plot.list</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                   <span class="va">plot.list</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="spagg_files/figure-html/view%20the%20data-1.png" width="768" style="display: block; margin: auto;">
The above plots show simulated data, but illustrate a common challenge
that arises in analyzing grouped point patterns reflecting multiple ROIs
of a tissue sample: heterogeneity in the spatial clustering patterns.
Each ROI shows a different clusterig pattern among the <code>a</code>
and <code>b</code> cell types.</p>
<p>We are going to use the spatial summary statistic, Ripley’s K, to
characterize the degree of adherence to clustering, repulsion, or
complete spatial randomness in each ROI. The <code>spagg</code> package
the contains five approaches for handling multiple spatial summary
statistics for associative analyses. Three of these approaches are
weighted aggregations of the spatial summaries using fixed weights. The
other two are ensemble approaches which generate random weights used to
construct weighted aggregations. Within each ensemble replication, we
test for an association between the weighted aggregation and the
sample-level outcome. We then ensemble the resulting p-values for an
omnibus test.</p>
<p>We first start by illustrating the weighted aggregations.</p>
</div>
<div class="section level3">
<h3 id="weighted-aggregations">Weighted Aggregations<a class="anchor" aria-label="anchor" href="#weighted-aggregations"></a>
</h3>
<p>We will first consider different approaches to averaging Ripely’s K
across ROIs within a sample. Let’s start by defining some notation.
Suppose for sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
we have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>i</mi></msub><annotation encoding="application/x-tex">R_i</annotation></semantics></math>
ROIs. Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub><annotation encoding="application/x-tex">n_{ir}</annotation></semantics></math>
be the number of cells in sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
ROI
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>.
Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>A</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub><annotation encoding="application/x-tex">A_{ir}</annotation></semantics></math>
represent the area of sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
ROI
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>.
Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>K</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>r</mi></mrow></msub><annotation encoding="application/x-tex">\hat K_{ir}</annotation></semantics></math>
represent the spatial distribution of cells evaluate at radius
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>.</p>
<p><code>spagg</code> contains implementations for the following three
weighted averages:</p>
<ol style="list-style-type: decimal">
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mover><mi>K</mi><mo accent="true">‾</mo></mover><mi>i</mi><mrow><mi>D</mi><mi>i</mi><mi>g</mi><mi>g</mi><mi>l</mi><mi>e</mi></mrow></msubsup><mo>=</mo><mfrac><mn>1</mn><mrow><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msub><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msub><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub><msub><mover><mi>K</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\begin{equation*}
\bar K_i^{Diggle} = \frac{1}{\sum_{r=1}^{R_i} n_{ir}} \sum_{r=1}^{R_i} n_{ir} \hat K_{ir}
\end{equation*}</annotation></semantics></math></p></li>
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mover><mi>K</mi><mo accent="true">‾</mo></mover><mi>i</mi><mrow><mi>B</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>e</mi><mi>l</mi><mi>e</mi><mi>y</mi></mrow></msubsup><mo>=</mo><mfrac><mn>1</mn><mrow><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msubsup><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow><mn>2</mn></msubsup></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msubsup><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow><mn>2</mn></msubsup><msub><mover><mi>K</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\begin{equation*}
  \bar K_i^{Baddeley} = \frac{1}{\sum_{r=1}^{R_i} n^2_{ir}} \sum_{r=1}^{R_i} n^2_{ir} \hat K_{ir} \end{equation*}</annotation></semantics></math></p></li>
<li><p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mover><mi>K</mi><mo accent="true">‾</mo></mover><mi>i</mi><mrow><mi>L</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>a</mi><mi>u</mi></mrow></msubsup><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msub><mi>A</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow><mrow><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><msub><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>R</mi><mi>i</mi></msub></munderover><mfrac><msubsup><mi>n</mi><mrow><mi>i</mi><mi>r</mi></mrow><mn>2</mn></msubsup><msub><mi>A</mi><mrow><mi>i</mi><mi>r</mi></mrow></msub></mfrac><msub><mover><mi>K</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\begin{equation*}
  \bar K_i^{Landau} = \frac{\sum_{r=1}^{R_i} A_{ir}}{\sum_{r=1}^{R_i} n_{ir}} \sum_{r=1}^{R_i} \frac{n^2_{ir}}{A_{ir}} \hat K_{ir} 
\end{equation*}</annotation></semantics></math></p></li>
</ol>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mover><mi>K</mi><mo accent="true">‾</mo></mover><mi>i</mi><mrow><mi>D</mi><mi>i</mi><mi>g</mi><mi>g</mi><mi>l</mi><mi>e</mi></mrow></msubsup><annotation encoding="application/x-tex">\bar K_i^{Diggle}</annotation></semantics></math>
(<span class="citation">Diggle, Lange, and Beneš (1991)</span>),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mover><mi>K</mi><mo accent="true">‾</mo></mover><mi>i</mi><mrow><mi>B</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>e</mi><mi>l</mi><mi>e</mi><mi>y</mi></mrow></msubsup><annotation encoding="application/x-tex">\bar K_i^{Baddeley}</annotation></semantics></math>
(<span class="citation">Baddeley et al. (1993)</span>), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mover><mi>K</mi><mo accent="true">‾</mo></mover><mi>i</mi><mrow><mi>L</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>a</mi><mi>u</mi></mrow></msubsup><annotation encoding="application/x-tex">\bar K_i^{Landau}</annotation></semantics></math>
(<span class="citation">Landau, Rabe-Hesketh, and Everall (2004)</span>)
were each proposed as approaches to aggregating replicated Ripley’s K
statistics. The motivation behind each of these aggregations is to
weight each Ripley’s K statistic by its sampling variance. However, the
sampling variance is generally difficult to write down explicitly for
Ripley’s K so each method relies on an approximation. The accuracy of
the approximation relies on whether the intensity of the spatial point
pattern (the ratio of the number of cells divided by the image area) is
consistent or varied across ROIs. If the intensity is consistent, all
methods should yield similar average Ripley’s K statistics and, in turn,
perform similarly-well for hypothesis testing. If the intensity is
different across ROIs, and also informative in predicting the outcome,
the Landau mean may perform better.</p>
<p>We first consider a univariate analysis where we analyze only one
cell type. We start with cell type <code>a</code> only and its
associations with sample-level outcomes. We estimate Ripley’s K for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mn>30</mn></mrow><annotation encoding="application/x-tex">r=30</annotation></semantics></math>
on each ROI. Note this may take several seconds (up to 30 seconds) to
run.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set the radius</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span></span>
<span><span class="co"># Save the image IDs</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize a data.frame to store the results for each ROI</span></span>
<span><span class="va">cell.a.results</span> <span class="op">&lt;-</span> <span class="va">simdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PID</span>, <span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>spatial <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                npoints <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                area <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span> </span>
<span><span class="co"># Iterate through the ROIs (this will take a few seconds)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span> <span class="co"># Save the ith image</span></span>
<span> <span class="va">image.i</span> <span class="op">&lt;-</span> <span class="va">simdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">type</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co"># Convert to a point process object</span></span>
<span>   <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/convexhull.xy.html" class="external-link">convexhull.xy</a></span><span class="op">(</span><span class="va">image.i</span><span class="op">$</span><span class="va">x</span>, <span class="va">image.i</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span>   <span class="va">image.i.subset</span> <span class="op">&lt;-</span> <span class="va">image.i</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"a"</span><span class="op">)</span></span>
<span>   <span class="va">image.ppp</span> <span class="op">&lt;-</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/as.ppp.html" class="external-link">as.ppp</a></span><span class="op">(</span><span class="va">image.i.subset</span>, W <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span>
<span>   <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/marks.html" class="external-link">marks</a></span><span class="op">(</span><span class="va">image.ppp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">image.i.subset</span><span class="op">$</span><span class="va">type</span></span>
<span></span>
<span>   <span class="co"># Compute Kest</span></span>
<span>   <span class="va">Ki</span> <span class="op">&lt;-</span> <span class="fu">spatstat.explore</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.explore/man/Kest.html" class="external-link">Kest</a></span><span class="op">(</span><span class="va">image.ppp</span>, r <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">r</span><span class="op">)</span></span>
<span>  </span>
<span>   <span class="co"># Calculate the number of points</span></span>
<span>   <span class="va">npoints.i</span> <span class="op">&lt;-</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/npoints.html" class="external-link">npoints</a></span><span class="op">(</span><span class="va">image.ppp</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="co"># Calculate the area</span></span>
<span>   <span class="va">area.i</span> <span class="op">&lt;-</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/area.owin.html" class="external-link">area</a></span><span class="op">(</span><span class="va">image.ppp</span><span class="op">)</span></span>
<span>  </span>
<span>   <span class="co"># Save the results</span></span>
<span>   <span class="va">cell.a.results</span><span class="op">[</span><span class="va">cell.a.results</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="op">]</span><span class="op">$</span><span class="va">spatial</span> <span class="op">&lt;-</span> <span class="va">Ki</span><span class="op">$</span><span class="va">iso</span><span class="op">[</span><span class="va">r</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span>   <span class="va">cell.a.results</span><span class="op">[</span><span class="va">cell.a.results</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="op">]</span><span class="op">$</span><span class="va">npoints</span> <span class="op">&lt;-</span> <span class="va">npoints.i</span></span>
<span>   <span class="va">cell.a.results</span><span class="op">[</span><span class="va">cell.a.results</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="op">]</span><span class="op">$</span><span class="va">area</span> <span class="op">&lt;-</span> <span class="va">area.i</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># View the first few rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cell.a.results</span><span class="op">)</span></span>
<span><span class="co">#&gt;   PID            id  spatial npoints     area</span></span>
<span><span class="co">#&gt; 1   1 PID.1.image.1 3402.412     206 8298.469</span></span>
<span><span class="co">#&gt; 2   1 PID.1.image.2 2779.338     538 9844.653</span></span>
<span><span class="co">#&gt; 3   1 PID.1.image.3 2623.948     134 7157.505</span></span>
<span><span class="co">#&gt; 4   1 PID.1.image.4 3382.632     151 8314.183</span></span>
<span><span class="co">#&gt; 5   1 PID.1.image.5 2911.225     157 7682.093</span></span>
<span><span class="co">#&gt; 6   2 PID.2.image.1 2374.916      62 7080.358</span></span></code></pre></div>
<p>We can now visualize the distribution of the spatial summaries within
each image as an illustration of the variation in spatial distribution
of cells of type <code>a</code> across ROIs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize the distribution of spatial summaries within each sample</span></span>
<span><span class="va">cell.a.results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>PID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">PID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PID</span>, y <span class="op">=</span> <span class="va">spatial</span>, group <span class="op">=</span> <span class="va">PID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Ripley's K statistics for ROIs within a each sample"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Kest"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spagg_files/figure-html/plot%20for%20univariate%20analysis-1.png" width="768" style="display: block; margin: auto;"></p>
<p>As the above plot illustrates, there can be considerable variation in
the spatial summary statistic values within a single sample.</p>
<p>After that, we will compute the weighted averages given above. We
will also compute a standard arithmetic mean as a comparison. Below, we
visualize the spread of the various spatial aggregation methods within
each sample. For some samples, the averages yield similar values. For
others, the averages exhibit large variation, suggesting they up- or
down-weight certain ROIs depending on the area of the ROI or the number
of cells.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute averages</span></span>
<span><span class="va">cell.a.results_mean</span> <span class="op">&lt;-</span> <span class="va">cell.a.results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_at</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">spatial</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, </span>
<span>                             <span class="op">~</span><span class="fu"><a href="../reference/landau.avg.html">landau.avg</a></span><span class="op">(</span>K.vec <span class="op">=</span> <span class="va">.x</span>, area.vec <span class="op">=</span> <span class="va">area</span>, n.vec <span class="op">=</span> <span class="va">npoints</span><span class="op">)</span>,</span>
<span>                             <span class="op">~</span><span class="fu"><a href="../reference/diggle.avg.html">diggle.avg</a></span><span class="op">(</span>K.vec <span class="op">=</span> <span class="va">.x</span>, n.vec <span class="op">=</span> <span class="va">npoints</span><span class="op">)</span>,</span>
<span>                             <span class="op">~</span><span class="fu"><a href="../reference/baddeley.avg.html">baddeley.avg</a></span><span class="op">(</span>K.vec <span class="op">=</span> <span class="va">.x</span>, n.vec <span class="op">=</span> <span class="va">npoints</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the averages</span></span>
<span><span class="va">cell.a.results_mean</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, names_to <span class="op">=</span> <span class="st">"mean"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">mean</span>, </span>
<span>                              <span class="st">"mean"</span> <span class="op">=</span> <span class="st">"Arithmetic Mean"</span>,</span>
<span>                              <span class="st">"landau.avg"</span> <span class="op">=</span> <span class="st">"Landau Mean"</span>,</span>
<span>                              <span class="st">"diggle.avg"</span> <span class="op">=</span> <span class="st">"Diggle Mean"</span>,</span>
<span>                              <span class="st">"baddeley.avg"</span> <span class="op">=</span> <span class="st">"Baddeley Mean"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>PID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">PID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PID</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">mean</span>, color <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Average Kest"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Averaged Ripley's K within each sample"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Aggregation Method"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spagg_files/figure-html/averages%20for%20univariate%20analysis-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We now have a data.frame with a column corresponding to each average.
We can add in the outcome variable, <code>out</code>, so we can do
association testing with the aggregated Ripley’s K statistics. We would
like to compare if the aggregated Ripley’s K statistics are equal
between cases (<code>out=1</code>) and controls (<code>out=0</code>). In
other words, we would like to test if the <code>average</code> spatial
distribution of cells across ROIs is the same between these two
groups.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, check the ordering matches</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">PID</span><span class="op">)</span> <span class="op">==</span> <span class="va">cell.a.results_mean</span><span class="op">$</span><span class="va">PID</span><span class="op">)</span> <span class="co"># TRUE!</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Add in the outcome</span></span>
<span><span class="va">cell.a.results_mean</span><span class="op">$</span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">simdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PID</span>, <span class="va">out</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test for an association between CD4 T cell spatial distributions and MHCII-high status</span></span>
<span><span class="va">mean.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">out</span> <span class="op">~</span> <span class="va">mean</span>, data <span class="op">=</span> <span class="va">cell.a.results_mean</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">diggle.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">out</span> <span class="op">~</span> <span class="va">diggle.avg</span>, data <span class="op">=</span> <span class="va">cell.a.results_mean</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">baddeley.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">out</span> <span class="op">~</span> <span class="va">baddeley.avg</span>, data <span class="op">=</span> <span class="va">cell.a.results_mean</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">landau.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">out</span> <span class="op">~</span> <span class="va">landau.avg</span>, data <span class="op">=</span> <span class="va">cell.a.results_mean</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the p-values in a table and display</span></span>
<span><span class="va">cell.a.pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mean"</span>, <span class="st">"Diggle"</span>, <span class="st">"Baddeley"</span>, <span class="st">"Landau"</span><span class="op">)</span>,</span>
<span>  P.Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mean.glm</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">diggle.glm</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">baddeley.glm</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">landau.glm</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the results</span></span>
<span><span class="va">cell.a.pvals</span></span>
<span><span class="co">#&gt;     Method     P.Value</span></span>
<span><span class="co">#&gt; 1     Mean 0.006060067</span></span>
<span><span class="co">#&gt; 2   Diggle 0.023752779</span></span>
<span><span class="co">#&gt; 3 Baddeley 0.040878265</span></span>
<span><span class="co">#&gt; 4   Landau 0.205325277</span></span></code></pre></div>
<p>Using a standard mean, the Diggle method, and the Baddeley approach,
we found a significant association between the spatial distribution of
cell type <code>a</code> and outcomes. We did not find this association,
however, using the Landau mean.</p>
<p>To explore the varied performance of these methods a bit more, we can
plot the intensity of cell type <code>a</code> within each ROI and
examine the variation across samples, as shown below. There is
considerable variation across samples and considerable variation within
some samples. Samples 4 and 6, for example, show very little variation
across ROIs. However, Sample 4 only had 1 image. Other samples, showed
more variation, like Samples 1 and 2. The overall spread in variation,
however, was only between 0.002 and 0.05.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate intensity for each ROI and plot</span></span>
<span><span class="va">cell.a.results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>intensity <span class="op">=</span> <span class="va">npoints</span><span class="op">/</span><span class="va">area</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>PID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">PID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PID</span>, y <span class="op">=</span> <span class="va">intensity</span>, group <span class="op">=</span> <span class="va">PID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Variation in Point Pattern Intensity Within Each Sample"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spagg_files/figure-html/plotting%20intensity-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># How many ROIs did each sample have?</span></span>
<span><span class="va">simdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PID</span>, <span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 2</span></span></span>
<span><span class="co">#&gt;      PID     n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  <span style="text-decoration: underline;">2</span>272</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  <span style="text-decoration: underline;">1</span>570</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3   466</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4   318</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  <span style="text-decoration: underline;">1</span>098</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6   170</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  <span style="text-decoration: underline;">2</span>292</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  <span style="text-decoration: underline;">1</span>004</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  <span style="text-decoration: underline;">1</span>419</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10   702</span></span>
<span></span>
<span><span class="co"># Calculate the range in intensity</span></span>
<span><span class="va">cell.a.results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>intensity <span class="op">=</span> <span class="va">npoints</span><span class="op">/</span><span class="va">area</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>min.intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">intensity</span><span class="op">)</span>,</span>
<span>                   max.intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">intensity</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   min.intensity max.intensity</span></span>
<span><span class="co">#&gt; 1   0.002237422    0.05464895</span></span></code></pre></div>
<p>We can also examine if the intensity differed between outcomes. Below
we plot the intensities across ROIs and examine if this associates with
case (<code>out=1</code>) or control (<code>out=0</code>) status. Below,
we see that there was some variation in ROI intensity across outcomes.
Nonetheless, the Landau mean still did not perform best.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add in the outcome</span></span>
<span><span class="va">cell.a.results</span><span class="op">$</span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">simdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PID</span>, <span class="va">id</span>, <span class="va">out</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">cell.a.results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>intensity <span class="op">=</span> <span class="va">npoints</span><span class="op">/</span><span class="va">area</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">out</span>, y <span class="op">=</span> <span class="va">intensity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Variation in Point Pattern Intensity Across Outcomes"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spagg_files/figure-html/intensity%20vs.%20outcome-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We also consider a bivariate analysis where we examine the bivariate
colocalization of cell types <code>a</code> and <code>b</code>. We
follow a similar series of steps, but instead use the
<code>Kcross</code> function to characterize the colocalization of these
cell types.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set the radius</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span></span>
<span><span class="co"># Initialize a data.frame to store the results for each ROI</span></span>
<span><span class="va">cell.ab.results</span> <span class="op">&lt;-</span> <span class="va">simdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PID</span>, <span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>spatial <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                npoints <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                area <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span> </span>
<span><span class="co"># Iterate through the ROIs (this will take a few seconds)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span> <span class="co"># Save the ith image</span></span>
<span> <span class="va">image.i</span> <span class="op">&lt;-</span> <span class="va">simdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">type</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co"># Convert to a point process object</span></span>
<span>   <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/convexhull.xy.html" class="external-link">convexhull.xy</a></span><span class="op">(</span><span class="va">image.i</span><span class="op">$</span><span class="va">x</span>, <span class="va">image.i</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span>   <span class="va">image.ppp</span> <span class="op">&lt;-</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/as.ppp.html" class="external-link">as.ppp</a></span><span class="op">(</span><span class="va">image.i</span>, W <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span>
<span>   <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/marks.html" class="external-link">marks</a></span><span class="op">(</span><span class="va">image.ppp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">image.i</span><span class="op">$</span><span class="va">type</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co"># Compute Kest</span></span>
<span>   <span class="va">Ki</span> <span class="op">&lt;-</span> <span class="fu">spatstat.explore</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.explore/man/Kcross.html" class="external-link">Kcross</a></span><span class="op">(</span><span class="va">image.ppp</span>, i <span class="op">=</span> <span class="st">"a"</span>, j <span class="op">=</span> <span class="st">"b"</span>, r <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">r</span><span class="op">)</span></span>
<span>  </span>
<span>   <span class="co"># Calculate the number of points</span></span>
<span>   <span class="va">npoints.i</span> <span class="op">&lt;-</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/npoints.html" class="external-link">npoints</a></span><span class="op">(</span><span class="va">image.ppp</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="co"># Calculate the area</span></span>
<span>   <span class="va">area.i</span> <span class="op">&lt;-</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/area.owin.html" class="external-link">area</a></span><span class="op">(</span><span class="va">image.ppp</span><span class="op">)</span></span>
<span>  </span>
<span>   <span class="co"># Save the results</span></span>
<span>   <span class="va">cell.ab.results</span><span class="op">[</span><span class="va">cell.ab.results</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="op">]</span><span class="op">$</span><span class="va">spatial</span> <span class="op">&lt;-</span> <span class="va">Ki</span><span class="op">$</span><span class="va">iso</span><span class="op">[</span><span class="va">r</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span>   <span class="va">cell.ab.results</span><span class="op">[</span><span class="va">cell.ab.results</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="op">]</span><span class="op">$</span><span class="va">npoints</span> <span class="op">&lt;-</span> <span class="va">npoints.i</span></span>
<span>   <span class="va">cell.ab.results</span><span class="op">[</span><span class="va">cell.ab.results</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="op">]</span><span class="op">$</span><span class="va">area</span> <span class="op">&lt;-</span> <span class="va">area.i</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># View the first few rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cell.ab.results</span><span class="op">)</span></span>
<span><span class="co">#&gt;   PID            id  spatial npoints     area</span></span>
<span><span class="co">#&gt; 1   1 PID.1.image.1 3352.665     388 8298.469</span></span>
<span><span class="co">#&gt; 2   1 PID.1.image.2 2778.717    1010 9844.653</span></span>
<span><span class="co">#&gt; 3   1 PID.1.image.3 2695.169     257 7157.505</span></span>
<span><span class="co">#&gt; 4   1 PID.1.image.4 3406.225     316 8314.183</span></span>
<span><span class="co">#&gt; 5   1 PID.1.image.5 2947.781     301 7682.093</span></span>
<span><span class="co">#&gt; 6   2 PID.2.image.1 2449.192     124 7080.358</span></span></code></pre></div>
<p>Following the same steps as above, we will compute the averages
within each <code>PID</code> and test for an association with the
outcome.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute averages</span></span>
<span><span class="va">cell.ab.results_mean</span> <span class="op">&lt;-</span> <span class="va">cell.ab.results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_at</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">spatial</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, </span>
<span>                             <span class="op">~</span><span class="fu"><a href="../reference/landau.avg.html">landau.avg</a></span><span class="op">(</span>K.vec <span class="op">=</span> <span class="va">.x</span>, area.vec <span class="op">=</span> <span class="va">area</span>, n.vec <span class="op">=</span> <span class="va">npoints</span><span class="op">)</span>,</span>
<span>                             <span class="op">~</span><span class="fu"><a href="../reference/diggle.avg.html">diggle.avg</a></span><span class="op">(</span>K.vec <span class="op">=</span> <span class="va">.x</span>, n.vec <span class="op">=</span> <span class="va">npoints</span><span class="op">)</span>,</span>
<span>                             <span class="op">~</span><span class="fu"><a href="../reference/baddeley.avg.html">baddeley.avg</a></span><span class="op">(</span>K.vec <span class="op">=</span> <span class="va">.x</span>, n.vec <span class="op">=</span> <span class="va">npoints</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First, check the ordering matches</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">PID</span><span class="op">)</span> <span class="op">==</span> <span class="va">cell.ab.results_mean</span><span class="op">$</span><span class="va">PID</span><span class="op">)</span> <span class="co"># TRUE!</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Add in the outcome</span></span>
<span><span class="va">cell.ab.results_mean</span><span class="op">$</span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">simdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PID</span>, <span class="va">out</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test for an association between CD4 T cell spatial distributions and MHCII-high status</span></span>
<span><span class="va">mean.ab.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">out</span> <span class="op">~</span> <span class="va">mean</span>, data <span class="op">=</span> <span class="va">cell.ab.results_mean</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">diggle.ab.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">out</span> <span class="op">~</span> <span class="va">diggle.avg</span>, data <span class="op">=</span> <span class="va">cell.ab.results_mean</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">baddeley.ab.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">out</span> <span class="op">~</span> <span class="va">baddeley.avg</span>, data <span class="op">=</span> <span class="va">cell.ab.results_mean</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">landau.ab.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">out</span> <span class="op">~</span> <span class="va">landau.avg</span>, data <span class="op">=</span> <span class="va">cell.ab.results_mean</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the p-values in a table and display</span></span>
<span><span class="va">cell.ab.pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mean"</span>, <span class="st">"Diggle"</span>, <span class="st">"Baddeley"</span>, <span class="st">"Landau"</span><span class="op">)</span>,</span>
<span>  P.Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mean.ab.glm</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">diggle.ab.glm</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">baddeley.ab.glm</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">baddeley.ab.glm</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the results</span></span>
<span><span class="va">cell.ab.pvals</span></span>
<span><span class="co">#&gt;     Method    P.Value</span></span>
<span><span class="co">#&gt; 1     Mean 0.02393126</span></span>
<span><span class="co">#&gt; 2   Diggle 0.01362797</span></span>
<span><span class="co">#&gt; 3 Baddeley 0.05261129</span></span>
<span><span class="co">#&gt; 4   Landau 0.05261129</span></span></code></pre></div>
<p>Here we found a significant association between the spatial
colocalization of cell types <code>a</code> and <code>b</code> with
outcomes using a standard arithmetic mean and using the Diggle mean but
not using the Baddeley or Landau mean.</p>
</div>
<div class="section level3">
<h3 id="ensemble-approaches">Ensemble Approaches<a class="anchor" aria-label="anchor" href="#ensemble-approaches"></a>
</h3>
<p>We now illustrate using ensemble testing to test the same hypothesis,
whether the spatial distribution of cells is equal between cases
(<code>out=1</code>) and controls (<code>out=0</code>). These ensemble
approaches consider multiple random weights used to construct the
aggregations of the spatial summary statistics. For each set of random
weights, we test for an association between the weighted aggregation and
outcome. We repeat this for many random weights and combine the
resulting p-values using a p-value combination method. For this purpose,
we use the Cauchy combination test (<span class="citation">Liu and Xie
(2020)</span>).</p>
<p>The motivation behind these ensemble approaches is that the best set
of weights (the weights that will yield the highest power) is generally
unknown at the outset. For this reason, considering many different
possible weights may gain us more power because we may capture the true
relationship between the aggregated spatial summary statistics and
sample-level outcome through randomly simulating weights.</p>
<p><code>spagg</code> contains implementations for two different
approaches:</p>
<ol style="list-style-type: decimal">
<li><p>: in this approach, <code>spagg</code> randomly generates weights
from a standard normal distribution which are used to construct a
weighted mean of the Ripley’s K estimates obtained from each ROI. This
process is repeated many times. For each random set of weights, the
association between the weighted mean spatial summary and sample-level
outcomes is tested. The resulting p-values are combined using the Cauchy
combination test. This approach is contained in the
<code>ensemble.avg</code> function.</p></li>
<li><p>: in this approach, <code>spagg</code> randomly generates weights
from a standard normal distribution and uses these weights as well as
the number of cells in each ROI to construct a weighted mean of Ripley’s
K estimates. This process is repeated many times and the resulting
p-values are combined using the Cauchy combination test. This approach
is contained in the <code>combo.weight.avg</code> function.</p></li>
</ol>
<p>We now run these approaches to testing for the univariate analysis
using the <code>cell.a.results</code> data.frame we constructed above
which contains the Ripley’s K value at <code>r=30</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run each ensemble test</span></span>
<span><span class="va">ensemble.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ensemble.avg.html">ensemble.avg</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cell.a.results</span>, </span>
<span>                             group <span class="op">=</span> <span class="st">"PID"</span>, </span>
<span>                             outcome <span class="op">=</span> <span class="st">"out"</span>, </span>
<span>                             model <span class="op">=</span> <span class="st">"logistic"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combo.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combo.weight.avg.html">combo.weight.avg</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cell.a.results</span>, </span>
<span>                              group <span class="op">=</span> <span class="st">"PID"</span>, </span>
<span>                              outcome <span class="op">=</span> <span class="st">"out"</span>, </span>
<span>                              model <span class="op">=</span> <span class="st">"logistic"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the p-values to the results above</span></span>
<span><span class="va">cell.a.pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind.data.frame</a></span><span class="op">(</span></span>
<span>  <span class="va">cell.a.pvals</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ensemble"</span>, <span class="st">"Combo"</span><span class="op">)</span>,</span>
<span>    P.Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ensemble.res</span><span class="op">$</span><span class="va">pval</span>, <span class="va">combo.res</span><span class="op">$</span><span class="va">pval</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the results</span></span>
<span><span class="va">cell.a.pvals</span></span>
<span><span class="co">#&gt;     Method     P.Value</span></span>
<span><span class="co">#&gt; 1     Mean 0.006060067</span></span>
<span><span class="co">#&gt; 2   Diggle 0.023752779</span></span>
<span><span class="co">#&gt; 3 Baddeley 0.040878265</span></span>
<span><span class="co">#&gt; 4   Landau 0.205325277</span></span>
<span><span class="co">#&gt; 5 Ensemble 0.009344770</span></span>
<span><span class="co">#&gt; 6    Combo 0.020319545</span></span></code></pre></div>
<p>Here, the mean and the ensemble approaches yielded the lowest
p-values. The combo approach also yielded a low p-value. This suggests
some concordance among the methods in detecting a significant
association between the spatial distribution of cell type <code>a</code>
and case/control status.</p>
<p>We can also perform ensemble testing for the bivariate case. We show
how to do this below using the <code>cell.ab.results</code> object.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add the outcome back into the data</span></span>
<span><span class="va">cell.ab.results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">cell.ab.results</span>, </span>
<span>                     <span class="va">simdata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">PID</span>, <span class="va">out</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                     by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"PID"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run each ensemble test</span></span>
<span><span class="va">ensemble.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ensemble.avg.html">ensemble.avg</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cell.ab.results</span>, group <span class="op">=</span> <span class="st">"PID"</span>, </span>
<span>                             outcome <span class="op">=</span> <span class="st">"out"</span>, model <span class="op">=</span> <span class="st">"logistic"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combo.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combo.weight.avg.html">combo.weight.avg</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cell.ab.results</span>, group <span class="op">=</span> <span class="st">"PID"</span>, </span>
<span>                              outcome <span class="op">=</span> <span class="st">"out"</span>, model <span class="op">=</span> <span class="st">"logistic"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span></span>
<span><span class="co"># Add the p-values to the results above</span></span>
<span><span class="va">cell.ab.pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind.data.frame</a></span><span class="op">(</span></span>
<span>  <span class="va">cell.ab.pvals</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ensemble"</span>, <span class="st">"Combo"</span><span class="op">)</span>,</span>
<span>    P.Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ensemble.res</span><span class="op">$</span><span class="va">pval</span>, <span class="va">combo.res</span><span class="op">$</span><span class="va">pval</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the results</span></span>
<span><span class="va">cell.ab.pvals</span></span>
<span><span class="co">#&gt;     Method    P.Value</span></span>
<span><span class="co">#&gt; 1     Mean 0.02393126</span></span>
<span><span class="co">#&gt; 2   Diggle 0.01362797</span></span>
<span><span class="co">#&gt; 3 Baddeley 0.05261129</span></span>
<span><span class="co">#&gt; 4   Landau 0.05261129</span></span>
<span><span class="co">#&gt; 5 Ensemble 0.02104012</span></span>
<span><span class="co">#&gt; 6    Combo 0.02473175</span></span></code></pre></div>
<p>Here, the ensemble and combo approaches yielded low p-values,
suggesting the spatial colocalization of cell types <code>a</code> and
<code>b</code> is associated with the outcome.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-baddeley1993analysis" class="csl-entry">
Baddeley, AJ, RA Moyeed, CV Howard, and A Boyde. 1993. <span>“Analysis
of a Three-Dimensional Point Pattern with Replication.”</span>
<em>Journal of the Royal Statistical Society: Series C (Applied
Statistics)</em> 42 (4): 641–68.
</div>
<div id="ref-diggle1991analysis" class="csl-entry">
Diggle, Peter J, Nicholas Lange, and Francine M Beneš. 1991.
<span>“Analysis of Variance for Replicated Spatial Point Patterns in
Clinical Neuroanatomy.”</span> <em>Journal of the American Statistical
Association</em> 86 (415): 618–25.
</div>
<div id="ref-landau2004nonparametric" class="csl-entry">
Landau, Sabine, Sophia Rabe-Hesketh, and Ian P Everall. 2004.
<span>“Nonparametric One-Way Analysis of Variance of Replicated
Bivariate Spatial Point Patterns.”</span> <em>Biometrical Journal:
Journal of Mathematical Methods in Biosciences</em> 46 (1): 19–34.
</div>
<div id="ref-liu2020cauchy" class="csl-entry">
Liu, Yaowu, and Jun Xie. 2020. <span>“Cauchy Combination Test: A
Powerful Test with Analytic p-Value Calculation Under Arbitrary
Dependency Structures.”</span> <em>Journal of the American Statistical
Association</em> 115 (529): 393–402.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sarah Samorodnitsky.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
